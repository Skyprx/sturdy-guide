<!DOCTYPE html>

<html>

<head>
<title>Storybook is loading</title>
<style>
html {
background: white radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.09) 100%);
}
html, body {
overflow: hidden;
width: 100vw;
height: 100vh;
}

#root {
position: absolute;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
}

#logo {
margin: 0;
display: block;
width: 300px;
max-width: 50vw;
animation: 20s fading cubic-bezier(0.94, 0.47, 0.87, 0.32) alternate;
filter: blur(0);
}

@keyframes fading { 
0% {filter: blur(60px)} 
100% {filter: blur(0)} 
} 

#spinner {
display: block;
position: absolute;
top: 50%;
left: 50%;
height: 40px;
width: 40px;
margin: -20px 0 0 -20px;
border: 4px rgba(0, 0, 0, 0.15) solid;
border-top: 4px rgba(0,0,0,0.5) solid;
border-radius: 50%;
animation: spin2 1s infinite linear;
}


@keyframes spin2 {
from {
transform: rotate(0deg);
transform: rotate(0deg);
}
to {
transform: rotate(359deg);
transform: rotate(359deg);
}
}
</style>
</head>
<body>
<div id="root">
<img id="logo" src="./storybook-logo.svg" alt="storybook is loading, please be patient" />
<div id="spinner"></div>

<script language="javascript" type="text/javascript">
const wsUri = `ws://${document.location.host}/sb-ws/`;
let output;

function init() {
  output = document.getElementById('output');
  testWebSocket();
}

function testWebSocket() {
  const websocket = new WebSocket(wsUri, ['sb-protocol']);
  websocket.onopen = (evt) => {
    onOpen(evt);
  };
  websocket.onclose = (evt) => {
    onClose(evt);
  };
  websocket.onmessage = (evt) => {
    onMessage(evt);
  };
  websocket.onerror = (evt) => {
    onError(evt);
  };
  function onOpen(evt) {
    writeToScreen('CONNECTED');
    doSend('WebSocket rocks');
  }

  function onClose(evt) {
    writeToScreen('DISCONNECTED');
  }

  function onMessage(evt) {
    writeToScreen(`<span style="color: blue;">RESPONSE: ${evt.data}</span>`);
    if (event.data === 'storybook ready') {
      document.location.reload();
    }
    // websocket.close();
  }

  function onError(evt) {
    writeToScreen(`<span style="color: red;">ERROR:</span> ${evt.data}`);
  }

  function doSend(message) {
    writeToScreen(`SENT: ${message}`);
    websocket.send(message);
  }

  function writeToScreen(message) {
    const pre = document.createElement('p');
    pre.style.wordWrap = 'break-word';
    pre.innerHTML = message;
    output.appendChild(pre);
  }
}

window.addEventListener('load', init, false);
</script>

<div id="output"></div>
</div>
</body>
</html>
